# Toio中断控制程序 - 完整版本指南

## 版本说明

我们提供了两个版本的程序来解决不同的需求：

### 🔥 推荐版本：3设备稳定版 
**文件**: `multi_toio_interrupt_control_3devices.py`

✅ **优点**：
- 连接稳定，几乎不会失败
- 避开了蓝牙连接数量限制
- 包含智能重试机制
- 性能最佳

❌ **限制**：
- 只支持3个toio设备

### ⚠️ 实验版本：4设备优化版
**文件**: `multi_toio_interrupt_control_4devices_optimized.py`

✅ **优点**：
- 支持4个toio设备
- 包含重试机制和错误处理

❌ **限制**：
- 可能遇到蓝牙连接限制
- 连接不如3设备版本稳定

## 已修复的问题 (v1.1)

1. **❌ 修复前错误**：
   ```
   TypeError: MultipleToioCoreCubes.__init__() got an unexpected keyword argument 'timeout'
   ```

2. **✅ 修复内容**：
   - 移除了不支持的 `timeout` 参数
   - 添加连接重试机制（最多3次）
   - 增加初始化延迟避免设备冲突
   - 改进错误提示

## 快速开始

### 方法1：使用3设备稳定版（推荐）

```bash
# 确保3个toio设备开机
python multi_toio_interrupt_control_3devices.py
```

### 方法2：尝试4设备版本

```bash
# 确保4个toio设备开机，关闭其他蓝牙设备
python multi_toio_interrupt_control_4devices_optimized.py
```

## 使用说明

1. **启动程序**后，程序会自动扫描并连接toio设备
2. **连接成功**后，所有toio开始随机移动
3. **控制方式**：
   - 输入 `0`、`1`、`2`（3设备版）或 `0`、`1`、`2`、`3`（4设备版）
   - 对应的toio会执行特殊动作：转180度 → 前进1秒 → 返回随机移动
   - 输入 `q` 退出程序

## LED颜色标识

| 设备ID | 颜色 | 描述 |
|--------|------|------|
| 0 | 🔴 红色 | 第一个toio |
| 1 | 🟢 绿色 | 第二个toio |
| 2 | 🔵 蓝色 | 第三个toio |
| 3 | 🟡 黄色 | 第四个toio（仅4设备版） |

## 故障排除

### 连接失败的解决方案

1. **检查设备状态**：
   - ✅ toio设备已开机且电量充足
   - ✅ 只开启所需数量的toio设备
   - ✅ 设备距离电脑较近（2米以内）

2. **检查蓝牙环境**：
   - 🔄 关闭其他蓝牙设备（耳机、鼠标等）
   - 🔄 重启蓝牙适配器
   - 🔄 确保没有其他程序占用toio

3. **程序相关**：
   - 🔄 重新启动程序（会自动重试3次）
   - 🔄 如果4设备版本失败，尝试3设备版本
   - 🔄 检查Python环境和toio库版本

### 常见错误和解决方案

| 错误类型 | 解决方案 |
|----------|----------|
| 找不到设备 | 检查toio是否开机，距离是否过远 |
| 连接超时 | 关闭其他蓝牙设备，重试 |
| 设备断连 | 检查toio电量，重新启动程序 |
| 控制无响应 | 设备可能正在执行动作，等待完成 |

## 技术特点

- **异步并发控制**：每个toio独立控制，互不干扰
- **状态管理**：支持随机移动和特殊动作两种状态
- **非阻塞输入**：控制台输入不会影响toio运动
- **优雅退出**：程序退出时自动停止所有toio并关闭LED
- **智能重试**：连接失败时自动重试，递增延迟时间

## 扩展方案

如需控制更多toio设备：

1. **分组控制**：将设备分成多组，每组3个
2. **轮换连接**：不同时连接所有设备
3. **多主机方案**：每台电脑控制3个设备
4. **序列控制**：先控制一组，完成后切换到另一组

---

**版本**: v1.1  
**更新日期**: 2025年1月  
**兼容性**: Python 3.8+, toio.py库 